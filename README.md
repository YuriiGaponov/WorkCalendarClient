# WorkCalendarClient

## Что это

Приложение‑помощник, которое узнаёт, какие дни рабочие, а какие — праздничные или выходные. Работает как «справочная» для других программ.

## Что умеет

- Спрашивает данные у внешних сервисов (через API и с веб‑сайтов).  
- Приводит информацию к единому виду: где рабочий день, где праздник, где перенос.  
- Отвечает на вопросы вроде «10 января — рабочий день?» через простой API.  
- Помнит полученные данные, чтобы не спрашивать по сто раз.  
- Если один источник не отвечает — пробует другой.

## Где пригодится

- В CRM и ERP: посчитать, когда задача должна быть готова с учётом праздников.  
- В системах планирования: составить график работы или отпусков.  
- В финансах: определить дату платежа, сдвинув её на рабочий день.  
- В любых программах, где надо знать, «работает ли офис 8 марта».

## Почему это удобно

- **Не привязано к одному источнику** — берёт данные откуда получится.  
- **Не падает** — если один сервис недоступен, попробует другой; старые данные покажет из кэша.  
- **Легко подключить** — достаточно отправить HTTP‑запрос.  
- **Всегда актуально** — регулярно обновляет информацию.

## Технические детали

- **Язык**: Python.  
- **Формат данных**: JSON.  
- **Интерфейс**: REST API (например, `GET /calendar?start=2025-01-01&end=2025-01-31`).  
- **Кэш**: Redis (ускоряет ответы и снижает нагрузку).  
- **Хранилище**: PostgreSQL/SQLite (для истории и настроек).  
- **Зависимости**: `fastapi`, `alembic`, `httpx`, `beautifulsoup4`, `redis`.

## Настройка окружения

Проект использует отдельные `.env`-файлы для разных окружений:

- `.env.development` — для локальной разработки;  
- `.env.production` — для боевого сервера;  
- `.env.testing` — для запуска тестов.

**Пример содержимого `.env`‑файла:**
```env
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
API_BASE_URL=https://example-api.com/v1
API_KEY=your_secret_api_key_here
CACHE_TTL=86400
```

## Как начать

1. **Скопируйте шаблон окружения**  
   ```bash
   cp .env.example .env.development
   ```
   Заполните файл нужными значениями.

2. **Установите зависимости**  
   ```bash
   pip install -r requirements.txt
   ```

3. **Запустите приложение**  

   Для разработки:  
   ```bash
   uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
   ```  

   Для production (с указанием окружения):  
   ```bash
   ENV_FILE=.env.production uvicorn app.main:app --host 0.0.0.0 --port 8000
   ```

4. **Проверьте работу**  
   Отправьте тестовый запрос:  
   ```bash
   curl "http://localhost:8000/calendar?start_date=2025-01-01&end_date=2025-01-07"
   ```

## Автоматическое применение миграций

Приложение автоматически применяет все ожидающие миграции базы данных при запуске (с помощью Alembic). При старте сервер выполняет команду `alembic upgrade head`, обеспечивая актуальность схемы БД.

**Важно**:  
- В продакшене убедитесь, что у приложения есть необходимые права на изменение схемы базы данных.  
- Для сложных миграций (связанных с потерей данных, длительными операциями и т. п.) рекомендуется **отключить** автоматическую активацию и выполнять их вручную.  
- Логи запуска содержат информацию о применённых миграциях — проверяйте их для контроля процесса.  

## Примеры запросов

- **Получить календарь на период**:  
  ```
  GET /calendar?start_date=2025-01-01&end_date=2025-01-31
  ```
- **Проверить, рабочий ли день**:  
  ```
  GET /is-working-day/2025-01-10
  ```

## Структура окружений

При запуске приложение автоматически подгружает настройки из соответствующего `.env`-файла в зависимости от переменной `ENV_FILE`:

- Если `ENV_FILE` не задана — используется `.env.development`.  
- Для тестов: `ENV_FILE=.env.testing`.  
- Для продакшена: `ENV_FILE=.env.production`.

Убедитесь, что нужный `.env`-файл присутствует в рабочей директории.

## Рекомендации по безопасности

- Не храните `.env`-файлы в репозитории (добавьте их в `.gitignore`).  
- Используйте разные ключи API и настройки для разных окружений.  
- Ограничьте доступ к Redis и БД извне.

## Лицензия

[Укажите вашу лицензию, например, MIT]