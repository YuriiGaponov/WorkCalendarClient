"""
Модуль app.core.db.py — настройка базы данных для WorkCalendarClient.

Определяет базовую конфигурацию SQLAlchemy для моделей приложения:
- базовый класс с общими атрибутами;
- автоматическое формирование имён таблиц;
- стандартное поле `id` как первичный ключ.

Используемые компоненты SQLAlchemy:
- `declarative_base` — фабрика базового класса моделей;
- `declared_attr` — позволяет определять атрибуты на уровне класса;
- `Column`, `Integer` — описание столбцов таблицы.

Структура:
- `PreBase` — миксин с предустановленными параметрами:
  - `__tablename__` генерируется как строчное имя класса;
  - поле `id` (Integer, primary_key=True) добавляется ко всем моделям.
- `Base` — декларативная база с наследованием от `PreBase`.

Преимущества подхода:
- единообразие структуры таблиц (везде есть `id`);
- автоматическая генерация имён таблиц (меньше ручного кода);
- возможность расширения `PreBase` для добавления общих полей (например, created_at).

Пример использования для новой модели:
    from app.core.db import Base

    class Holiday(Base):
        name = Column(String)
        date = Column(Date)

В результате:
- таблица будет называться `holiday`;
- в ней автоматически появится поле `id`.

Требования:
- установленный пакет `sqlalchemy`;
- корректная настройка подключения к БД в другом модуле (например, через `create_engine`).
"""

from sqlalchemy import Column, Integer, create_engine
from sqlalchemy.orm import declared_attr, declarative_base

from .settings import settings


class PreBase:
    """
    Базовый класс с предустановленными параметрами для моделей БД.

    Обеспечивает автоматическое формирование имени таблицы
    на основе имени класса и добавляет поле `id`.
    """

    @declared_attr
    def __tablename__(cls):
        """
        Формирует имя таблицы как строчное представление имени класса.
        """
        return cls.__name__.lower()

    id = Column(Integer, primary_key=True)

Base = declarative_base(cls=PreBase)
"""
Декларативная база для моделей SQLAlchemy.

Наследует параметры от `PreBase`, включая автоматическое имя таблицы
и поле `id`. Используется как родительский класс для всех моделей БД.
"""

engine = create_engine(settings.DATABASE_URL)
"""
Объект движка SQLAlchemy для подключения к БД.

Инициализирован на основе строки подключения из настроек приложения.
"""
